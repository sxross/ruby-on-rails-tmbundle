h1. Peepcode Script

h2. Introduction

Many many people's first introduction to Ruby on Rails was the 15 minute video from DHH showing how you create a blog application with Rails. Nearly everyone finished that video asking one question: what was that editor? It is awesome.

Let's take a stroll down memory lane. We pick up the action at the X minute mark:

[transition into a portion of the video that shows off TMs features, plus DHH saying "Whooops!"]

What is interesting, is that as fast as David is able to write his blog application, even with his detour demonstrating the now deleted scaffold command, he never uses any special TextMate extensions for Rails. He uses some HTML snippets and commands and some Ruby snippets and commands. The original Ruby on Rails extensions were in their infancy.

[Open Bundle Editor] A collection of TextMate extensions is called a "bundle".

When working with Rails with TextMate you'll use several "bundles":

* HTML
* Ruby
* Ruby on Rails
* JavaScript

You might also use the ProtoType, jQuery or other JavaScript bundle if you use those libraries.

Ruby on Rails 2.0 was recently released and includes many improvements to
* the syntax that you type [<code>redirect_to :action => 'show', :id => @person</code> became <code>redirect_to @person</code>]
* changes to some file extensions [rhtml -> html.erb] and
* changes to some file name conventions [user_controller.rb -> users_controller.rb, more commonly].

The Ruby on Rails bundle has also been given a major upgrade to match all the changes for developing Rails 2.0 applications.

The snippets and commands we're going to look at are actually described across all three bundles. Often it is the Rails bundle that reuses the HTML and Ruby bundles. For example, in an HTML file you have a variety of ways to create new elements. [examples] Within an html.erb file you can reuse all the same snippets and commands.


h2. Know thy Editor

Overview key icons (see PeepCode TM video)

Preferences > Advanced > Folder References > Folder Patterns: add 'vendor/rails' and it will ignore that folder in any project - both from the Dock and from Search.

h2. Models and Migrations

* Create new app
* Go to app/controllers/application.rb (need a Ruby on Rails file)
* ^| + 1 - Call Generate Script - create new model "Post"  TODO - not working @ moment
  OR CLI:script/generate model Post title:string
* Go to migration file: Cmd+T + 001
* t. - list of available sexy migration columns; when selecting one, another t. is automatically created for you. (create body:text + published:boolean)
* Shft+^+K - remove a line
* CLI:script/generate model Comment
* Cmd+T + 002 - comment migration + add t.references :post, body:text, name:string
* Ctrl+| + 3 - run migrations
  * See error?
  * In terminal, go to "/Applications/TextMate.app/Contents/SharedSupport/Support/lib" and rename/remove Builder.rb
  * Run migrations again

* Go to post.rb
  * hm + comments; notice you can tab across to change fields if required
* Go to comments.rb
  * bt + post; notice the autocompletions are correct here, but still optional for rails so can be deleted
  * vp + name, body
  * [Ctrl-Esc -> Models] All the validations are available as snippets based on the first letter of each word.
* Place the cursor on 'Comment' class name, Sft+Ctrl+Cmd+S -> shows schema for this class. Alternately, place it on 'post' to get the schema for Post class.

h2. Testing

I'll talk more about navigating between files in a Rails application later, but for the moment, know that there is a special relationship between a model file and a unit test file. You can toggle between them with Alt+Cmd+DownArrow.

The Rails generator for models created this unit test file and a fixtures file.

First, let's set up some fixtures for posts and comments. Go to posts.yml and create a "with_comments"
and a "without_comments" fixture. Now go to comments.yml - using Ctrl+Cmd+R to show posts.yml in the dock.

TODO - how to move focus from editor to dock?

Within comments, create one comment:

<pre>valid:
  name: Dr Nic
  body: Cool post
  post:</pre>

With Rails 2.0, your fixture ids are no longer required, and you can use Foxy Fixtures to select an associated fixture. Here we'd type 'with_comments' to reference that posts.yml fixture. But, since the column name is 'post' we can get a drop-down list using Alt+Esc. We'll use this same fixture autocompletion feature again within the test files.

Back to the comments unit test, and that dummy test needs removing.

Create a new test method with <code>deft</code> + <code>should_require_title</code>.

Type <code>posts(:)</code> and Alt+Esc to access the fixtures autocompletion. You can now select a posts.yml fixture. Note, the current implementation replaces the whole line, so if you need multiple or want a different instance variable you'll need to make some manual changes.

Finished:

<pre syntax="ruby">def test_should_require_title
  @post = posts(:one)
  @comment = @post.comments.create
  @comment.valid?
  assert(@comment.errors[:name], "Should be errors for name field")
end</pre>

To run your unit tests, Ctrl-\ + 'Test Units' or 'Test Recent'.

h2. Controllers and Routing



h2. Views


h2. Extending